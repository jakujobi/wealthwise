{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="calculator-header py-4 text-center">
  <div class="container">
    <h1 class="display-5 fw-bold mb-2">Budgeting Tool</h1>
    <p class="lead mb-0">Plan your finances and track your spending to meet your savings goals</p>
  </div>
</div>

<div class="container py-5">
  <div class="row">
    <!-- Calculator Form -->
    <div class="col-lg-7 mb-4 mb-lg-0">
      <div class="calculator-card">
        <div class="calculator-card-header p-4">
          <h2 class="h4 mb-0"><i class="bi bi-wallet2 me-2"></i>Budget Details</h2>
        </div>
        <div class="calculator-card-body p-4">
          <form method="POST" class="calculator-form">
            {% csrf_token %}
            <!-- Income fields -->
            <div class="mb-3">
              <label for="fixed_income" class="form-label">Fixed Income:</label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="number" step="0.01" name="fixed_income" id="fixed_income" class="form-control" required value="{{ form_data.fixed_income }}" />
              </div>
            </div>
            <div class="mb-3">
              <label for="variable_income" class="form-label">Variable Income:</label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="number" step="0.01" name="variable_income" id="variable_income" class="form-control" required value="{{ form_data.variable_income }}" />
              </div>
            </div>
            <div class="mb-3">
              <label for="one_year_savings_goal" class="form-label">One Year Savings Goal:</label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="number" step="0.01" name="one_year_savings_goal" id="one_year_savings_goal" class="form-control" required value="{{ form_data.one_year_savings_goal }}" />
              </div>
            </div>
            <!-- Expense fields -->
            <div class="mb-3">
              <label for="housing" class="form-label">Housing:</label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="number" step="0.01" name="housing" id="housing" class="form-control" required value="{{ form_data.housing }}" />
              </div>
            </div>
            <div class="mb-3">
              <label for="taxes" class="form-label">Taxes:</label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="number" step="0.01" name="taxes" id="taxes" class="form-control" required value="{{ form_data.taxes }}" />
              </div>
            </div>
            <div class="mb-3">
              <label for="car_payment" class="form-label">Car Payment:</label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="number" step="0.01" name="car_payment" id="car_payment" class="form-control" required value="{{ form_data.car_payment }}" />
              </div>
            </div>
            <div class="mb-3">
              <label for="internet_phone" class="form-label">Internet and Phone:</label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="number" step="0.01" name="internet_phone" id="internet_phone" class="form-control" required value="{{ form_data.internet_phone }}" />
              </div>
            </div>
            <div class="mb-3">
              <label for="subscriptions" class="form-label">Subscriptions:</label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="number" step="0.01" name="subscriptions" id="subscriptions" class="form-control" required value="{{ form_data.subscriptions }}" />
              </div>
            </div>
            <div class="mb-3">
              <label for="food" class="form-label">Food:</label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="number" step="0.01" name="food" id="food" class="form-control" required value="{{ form_data.food }}" />
              </div>
            </div>
            <div class="mb-3">
              <label for="entertainment" class="form-label">Entertainment:</label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="number" step="0.01" name="entertainment" id="entertainment" class="form-control" required value="{{ form_data.entertainment }}" />
              </div>
            </div>
            <div class="mb-3">
              <label for="personal_items" class="form-label">Personal Items:</label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="number" step="0.01" name="personal_items" id="personal_items" class="form-control" required value="{{ form_data.personal_items }}" />
              </div>
            </div>
            <div class="mb-3">
              <label for="utilities" class="form-label">Utilities:</label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="number" step="0.01" name="utilities" id="utilities" class="form-control" required value="{{ form_data.utilities }}" />
              </div>
            </div>
            <div class="mb-3">
              <label for="transportation" class="form-label">Transportation:</label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="number" step="0.01" name="transportation" id="transportation" class="form-control" required value="{{ form_data.transportation }}" />
              </div>
            </div>
            <div class="mb-3">
              <label for="medical" class="form-label">Medical:</label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="number" step="0.01" name="medical" id="medical" class="form-control" required value="{{ form_data.medical }}" />
              </div>
            </div>
            <div class="mb-3">
              <label for="misc" class="form-label">Miscellaneous:</label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="number" step="0.01" name="misc" id="misc" class="form-control" required value="{{ form_data.misc }}" />
              </div>
            </div>
            <!--date for budget-->
            <div class="mb-3">
              <label for="budget_month_year" class="form-label">Budget Month and Year:</label>
              <div class="input-group">
                <select name="budget_month" id="budget_month" class="form-control" required>
                  <option value="01" {% if form_data.budget_month == 1 %}selected{% endif %}>January</option>
                  <option value="02" {% if form_data.budget_month == 2 %}selected{% endif %}>February</option>
                  <option value="03" {% if form_data.budget_month == 3 %}selected{% endif %}>March</option>
                  <option value="04" {% if form_data.budget_month == 4 %}selected{% endif %}>April</option>
                  <option value="05" {% if form_data.budget_month == 5 %}selected{% endif %}>May</option>
                  <option value="06" {% if form_data.budget_month == 6 %}selected{% endif %}>June</option>
                  <option value="07" {% if form_data.budget_month == 7 %}selected{% endif %}>July</option>
                  <option value="08" {% if form_data.budget_month == 8 %}selected{% endif %}>August</option>
                  <option value="09" {% if form_data.budget_month == 9 %}selected{% endif %}>September</option>
                  <option value="10" {% if form_data.budget_month == 10 %}selected{% endif %}>October</option>
                  <option value="11" {% if form_data.budget_month == 11 %}selected{% endif %}>November</option>
                  <option value="12" {% if form_data.budget_month == 12 %}selected{% endif %}>December</option>
                </select>
                <input type="number" name="budget_year" id="budget_year" class="form-control" min="1900" max="2100" step="1" required value="{{ form_data.budget_year }}" />
              </div>
            </div>                      
            <!--buttons-->
            <button type="submit" name='action' value="calculate" class="btn btn-primary w-100 mb-3">Calculate</button>
            <button type="submit" name='action' value="save" class="btn btn-secondary w-100 mb-3">Save to Database</button>
            <button type="submit" name='action' value="load" class="btn btn-secondary w-100" formnovalidate>Load Saved Entries</button>
          </form>
          {% if overspend_areas or savings_goal_message %}
          <div class="mt-4">
            <div class="card bg-light">
              <div class="card-body">
                <h2 class="h4 mb-3">Results</h2>
                {% if overspend_areas %}
                <div class="mb-3">
                  <strong>Warning:</strong>
                  <pre>{{ overspend_areas }}</pre>
                </div>
                {% endif %}
                {% if savings_goal_message %}
                <div class="mb-3">
                  <strong>Savings Goal:</strong>
                  <div class="h5 text-primary">{{ savings_goal_message }}</div>
                </div>
                {% endif %}
              </div>
            </div>
          </div>
          
          <div class="d-flex justify-content-between mt-4">
            <a href="{% url 'calculators_home' %}" class="btn btn-outline-secondary">
              <i class="bi bi-arrow-left me-2"></i>Back to Calculators
            </a>
            <button class="btn btn-outline-primary" onclick="window.print()">
              <i class="bi bi-printer me-2"></i>Print Results
            </button>
          </div>
        </div>
      </div>
      {% else %}
      <div class="calculator-card h-100 d-flex flex-column justify-content-center align-items-center p-5">
        <div class="empty-state text-center">
          <img src="{% static 'images/calculator-illustration.svg' %}" alt="Calculator" class="empty-state-image mb-4" style="max-width: 200px;">
          <h3 class="h4 mb-3">No Results Yet</h3>
          <p class="text-muted mb-0">Fill out the form to analyze your budget and savings plan</p>
        </div>
      </div>
      {% endif %}
    </div>
  </div>
</div>
<div class="mt-4">
  <h2 class="h4 mb-3">Previous Budgets</h2>
  {% if previous_entries %}
  <table class="table">
    <thead>
      <tr>
        <th>Date Saved</th>
        <th>Budget Month/Year</th>
        <th>Input Data</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for entry in previous_entries %}
      <tr>
        <td>{{ entry.usage_date }}</td>
        <td>{{ entry.budget_for_date }}</td>
        <td><pre>{{ entry.input_data }}</pre></td>
        <td>
          <!-- Modify button to load this entry -->
          <form method="POST">
            {% csrf_token %}
            <input type="hidden" name="action" value="modify">
            <input type="hidden" name="entry_id" value="{{ entry.usage_id }}">
            <button type="submit" class="btn btn-warning btn-sm mb-1">Modify</button>
          </form>
          <!-- DELETE button to erase this entry -->
          <form method="POST">
            {% csrf_token %}
            <input type="hidden" name="action" value="delete">
            <input type="hidden" name="entry_id" value="{{ entry.usage_id }}">
            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
          </form>
          
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p>No previous budget entries found. Use the tool and save a budget to view it here!</p>
  {% endif %}
</div>
{% endblock content %}
